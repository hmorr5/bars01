import urllib2
import urllib
import re

d = {}
with open("data.txt") as f:
    for line in f:
       (bar, val) = line.split()
       d[bar] = int(val)

d2 = {}
with open("data2.txt") as f:
    for line in f:
       (bar, c_num) = line.split()
       d2[bar] = int(c_num)

def bar_l():
    "gets the list of bars"
    for key in d:
        print key

def bars(bar):
    "gets the bar price info. Type format : bars('Iron') " 
    a = ''
    if bar not in d:
       print 'That type of bar does not exist, please try again'
    else:
        a = d.get(bar)
        return 'The price of ' + str(bar) + ' bars are ' + str(a) + ' gold coins'
        
def c_num(bar):
    "gets the amount of coal needed"
    a = ''
    if bar not in d2:
        print 'That type of bar does not require coal, please try again'
    else:
        a = d2.get(bar)
        return 'The ' + str(bar) + ' bar requires ' + str(a) + ' coal per bar'

def finditemidsource(nameid):
   """grabs source code"""
   crudelist = []
   clearstr = ""
   lastitem = ""
   cleartags = re.compile(r'<.*?>')
   request = urllib2.Request("http://www.runelocus.com/tools/itemlist.html?name=" + nameid+"&search=Search")
   response = urllib2.urlopen(request)
   html = response.read()
   startind = html.find("<tbody>")
   endind = html.find("</tbody>")
   iteminfo = html[startind:endind]
   trlist = [n for n in xrange(len(iteminfo)) if iteminfo.find('<td>', n) == n]
   tr_endlist = [n for n in xrange(len(iteminfo)) if iteminfo.find('</td>', n) == n]
   for num,content in enumerate(trlist):
      clearstr = cleartags.sub('',iteminfo[trlist[num]: tr_endlist[num]])
      if clearstr == "":
         a = cleartags.sub('',iteminfo[trlist[num-1]: tr_endlist[num-1]])
         b = cleartags.sub('',iteminfo[trlist[num-2]: tr_endlist[num-2]])
         if a != lastitem:
            crudelist.append(a+","+b)
         lastitem = cleartags.sub('',iteminfo[trlist[num-1]: tr_endlist[num-1]])      
   print crudelist
   if crudelist == []:
      print "this item type/product does not excist"
      
def Webinfo(nameid, itemid):
    """grabs source code"""
    request = urllib2.Request("http://services.runescape.com/m=itemdb_rs/" + nameid + "/" +"viewitem.ws?obj="+ itemid)
    response = urllib2.urlopen(request)
    html = response.read()
    startind = html.find("<tbody>")
    endind = html.find("</tbody>")
    iteminfo = html[startind:endind]
    print iteminfo


#links for data:
#http://services.runescape.com/m=itemdb_rs/results.ws     Just type in bar, ore and coal form the coresponding lists
#http://services.runescape.com/m=itemdb_rs/Nature_rune/viewitem.ws?obj=561      EXXTRA nature rune price

#Calculation:

#Profit = bar price - (coal Price * amount of coal) + ore price [optional + nature rune price]
#XpGain = smelthing xp [optional + superheat cast xp , magic] 
